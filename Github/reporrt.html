<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report and Complaint</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Report and Complaint</h1>

    <form id="Record" onsubmit="return save()">
        <label>First Name:</label>
        <input type="text" id="FNInput" placeholder="Enter First Name" required><br><br>

        <label>Last Name:</label>
        <input type="text" id="LNInput" placeholder="Enter Last Name" required><br><br>

        <label>Address:</label>
        <input type="text" id="ADInput" placeholder="Enter Address" required><br><br>

        <label>Email:</label>
        <input type="email" id="EInput" placeholder="Enter Email" required><br><br>

        <label>Complaint Type:</label>
        <select id="type" required>
            <option value="">--PLEASE SELECT--</option>
            <option value="Noise Complaint"> Noise Complaint</option>
            <option value="Garbage Problem"> Garbage or Improper Waste Disposal</option>
            <option value="Boundary Dispute"> Boundary or Trespassing Dispute</option>
            <option value="Public Disturbance"> Public Disturbance or Drunkenness</option>
            <option value="Domestic Violence"> Domestic Violence or Family Quarrel</option>
            <option value="Child Support"> Child Support or Neglect</option>
            <option value="Unsanitary Conditions"> Unsanitary Living Conditions</option>
            <option value="Stray Animals"> Stray or Nuisance Animals</option>
            <option value="Vandalism Theft"> Vandalism or Petty Theft</option>
            <option value="Curfew Violation"> Curfew Violation</option>
            <option value="Road Drainage"> Road or Drainage Problem</option>
            <option value="Streetlight Issue"> Broken or Missing Streetlight</option>
            <option value="Suspicious Activity"> Suspicious Person or Activity</option>
            <option value="Lost Found"> Lost and Found Report</option>
            <option value="Other">Other</option>
        </select><br><br>

        <textarea id="description" placeholder="Description (Optional)"></textarea><br><br>

        <div class="button-container">
            <button type="submit">Save</button>
            <button type="button" onclick="window.location.href='homepage.html'">Back to Home</button>
        </div>
    </form> 

    <!-- Popup Message -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <h2>✅ Report Submitted</h2>
            <p>Your report has been recorded.<br>Fast action will be taken by the barangay team.<br>Thank you for your cooperation!</p>
            <button onclick="closePopup()">OK</button>
        </div>
    </div>

    <script>
        const DB_KEY = "record";
        let db = JSON.parse(localStorage.getItem(DB_KEY)) || [];

        function save() {
            let f = document.getElementById("FNInput").value;
            let l = document.getElementById("LNInput").value;
            let a = document.getElementById("ADInput").value;
            let e = document.getElementById("EInput").value;
            let type = document.getElementById("type").value;
            let description = document.getElementById("description").value;
            let datetime = new Date().toLocaleString();

            // Validation: check if user selected a valid complaint type
            if (type === "") {
                alert("⚠️ Please select a valid complaint type before submitting.");
                return false; // prevent form submission
            }

            // Add a new report with "Pending" status
            db.push({
                first_name: f,
                last_name: l,
                address: a,
                email: e,
                category: type,
                description: description,
                date_time: datetime,
                status: "Pending",  // Set the default status to "Pending"
                urgent: ["Boundary Dispute", "Public Disturbance", "Domestic Violence", "Curfew Violation", "Suspicious Activity"].includes(type) // Mark as urgent if matches these types
            });

            // Store the updated array in localStorage
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            document.getElementById("Record").reset();  // Reset the form

            // Show popup message
            const popup = document.getElementById("popup");
            popup.style.display = "flex";

            // Hide the popup after 3 seconds
            setTimeout(() => {
                popup.style.display = "none";
            }, 3000);

            return false; // Prevent the page from reloading
        }

        // Function to close the popup message
        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }
    </script>
</body>
</html>
